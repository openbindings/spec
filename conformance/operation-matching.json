{
  "$comment": "OpenBindings v0.1 conformance suite: operation matching cases. Each case tests the operation matching algorithm and overall compatibility assessment defined in the spec. Fields: name (descriptive), target (partial OBI with optional location + operations), candidate (partial OBI with optional imports + operations), result (object with per-operation outcomes and overall compatible boolean).",
  "cases": [
    {
      "$comment": "=== Basic matching ==="
    },
    {
      "name": "exact match: single method, identical schemas",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              },
              "required": [
                "title"
              ]
            },
            "output": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                }
              },
              "required": [
                "id"
              ]
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              },
              "required": [
                "title"
              ]
            },
            "output": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                }
              },
              "required": [
                "id"
              ]
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible",
            "output": "compatible"
          }
        }
      }
    },
    {
      "name": "missing operation: target has op that candidate lacks",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          },
          "task.delete": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                }
              },
              "required": [
                "id"
              ]
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "result": {
        "compatible": false,
        "operations": {
          "task.create": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible"
          },
          "task.delete": {
            "match": "missing"
          }
        }
      }
    },
    {
      "name": "kind mismatch: target has method, candidate has event",
      "target": {
        "operations": {
          "task.created": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.created": {
            "kind": "event",
            "payload": {
              "type": "object"
            }
          }
        }
      },
      "result": {
        "compatible": false,
        "operations": {
          "task.created": {
            "match": "primary_key",
            "kind": "mismatch"
          }
        }
      }
    },
    {
      "$comment": "=== Schema slot handling ==="
    },
    {
      "name": "unspecified slots: target has no output, candidate has output \u2014 slot skipped",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            },
            "output": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible",
            "output": "unspecified"
          }
        }
      }
    },
    {
      "name": "unspecified slots: both omit output \u2014 slot skipped",
      "target": {
        "operations": {
          "ping": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "ping": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "ping": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible",
            "output": "unspecified"
          }
        }
      }
    },
    {
      "name": "null is same as absent: target output is null, candidate has no output",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            },
            "output": null
          }
        }
      },
      "candidate": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible",
            "output": "unspecified"
          }
        }
      }
    },
    {
      "name": "event: payload comparison",
      "target": {
        "operations": {
          "task.completed": {
            "kind": "event",
            "payload": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "status": {
                  "type": "string"
                }
              },
              "required": [
                "id",
                "status"
              ]
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.completed": {
            "kind": "event",
            "payload": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "status": {
                  "type": "string"
                }
              },
              "required": [
                "id",
                "status"
              ]
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.completed": {
            "match": "primary_key",
            "kind": "match",
            "payload": "compatible"
          }
        }
      }
    },
    {
      "$comment": "=== Aliases ==="
    },
    {
      "name": "alias match: candidate operation matched via alias",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "tasks.new": {
            "kind": "method",
            "aliases": [
              "task.create"
            ],
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "alias",
            "kind": "match",
            "input": "compatible"
          }
        }
      }
    },
    {
      "name": "alias conflict: two candidate operations alias the same target name \u2014 error",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "tasks.new": {
            "kind": "method",
            "aliases": [
              "task.create"
            ],
            "input": {
              "type": "object"
            }
          },
          "tasks.add": {
            "kind": "method",
            "aliases": [
              "task.create"
            ],
            "input": {
              "type": "object"
            }
          }
        }
      },
      "result": {
        "compatible": false,
        "operations": {
          "task.create": {
            "match": "ambiguous"
          }
        }
      }
    },
    {
      "$comment": "=== satisfies ==="
    },
    {
      "name": "satisfies: explicit match via satisfies mapping",
      "target": {
        "location": "https://example.com/target.json",
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "candidate": {
        "imports": {
          "target": "https://example.com/target.json"
        },
        "operations": {
          "acme.createTask": {
            "kind": "method",
            "satisfies": [
              {
                "interface": "target",
                "operation": "task.create"
              }
            ],
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "satisfies",
            "kind": "match",
            "input": "compatible"
          }
        }
      }
    },
    {
      "name": "satisfies: resolves against alias of target operation",
      "target": {
        "location": "https://example.com/target.json",
        "operations": {
          "task.create": {
            "kind": "method",
            "aliases": [
              "createTask"
            ],
            "input": {
              "type": "object"
            }
          }
        }
      },
      "candidate": {
        "imports": {
          "target": "https://example.com/target.json"
        },
        "operations": {
          "acme.new": {
            "kind": "method",
            "satisfies": [
              {
                "interface": "target",
                "operation": "createTask"
              }
            ],
            "input": {
              "type": "object"
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "satisfies",
            "kind": "match",
            "input": "compatible"
          }
        }
      }
    },
    {
      "name": "satisfies preferred over fallback: satisfies wins when both could match",
      "target": {
        "location": "https://example.com/target.json",
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "candidate": {
        "imports": {
          "target": "https://example.com/target.json"
        },
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "x": {
                  "type": "string"
                }
              }
            }
          },
          "acme.createTask": {
            "kind": "method",
            "satisfies": [
              {
                "interface": "target",
                "operation": "task.create"
              }
            ],
            "input": {
              "type": "object"
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "satisfies",
            "kind": "match",
            "input": "compatible"
          }
        }
      }
    },
    {
      "$comment": "=== Candidate extra operations ==="
    },
    {
      "name": "candidate has extra operations beyond target \u2014 still compatible",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object"
            }
          },
          "task.delete": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "result": {
        "compatible": true,
        "operations": {
          "task.create": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible"
          }
        }
      }
    },
    {
      "$comment": "=== Schema incompatibility ==="
    },
    {
      "name": "schema incompatibility: input type mismatch",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "count": {
                  "type": "integer"
                }
              }
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "count": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "result": {
        "compatible": false,
        "operations": {
          "task.create": {
            "match": "primary_key",
            "kind": "match",
            "input": "incompatible"
          }
        }
      }
    },
    {
      "name": "schema incompatibility: output widens enum",
      "target": {
        "operations": {
          "task.get": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                }
              }
            },
            "output": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "string",
                  "enum": [
                    "open",
                    "closed"
                  ]
                }
              },
              "required": [
                "status"
              ]
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.get": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                }
              }
            },
            "output": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "string",
                  "enum": [
                    "open",
                    "closed",
                    "archived"
                  ]
                }
              },
              "required": [
                "status"
              ]
            }
          }
        }
      },
      "result": {
        "compatible": false,
        "operations": {
          "task.get": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible",
            "output": "incompatible"
          }
        }
      }
    },
    {
      "$comment": "=== Multiple operations ==="
    },
    {
      "name": "multiple operations: one compatible, one incompatible \u2014 overall incompatible",
      "target": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            }
          },
          "task.list": {
            "kind": "method",
            "output": {
              "type": "object",
              "properties": {
                "items": {
                  "type": "array",
                  "items": {
                    "type": "object"
                  }
                }
              },
              "required": [
                "items"
              ]
            }
          }
        }
      },
      "candidate": {
        "operations": {
          "task.create": {
            "kind": "method",
            "input": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                }
              }
            }
          },
          "task.list": {
            "kind": "method",
            "output": {
              "type": "object",
              "properties": {
                "results": {
                  "type": "array",
                  "items": {
                    "type": "object"
                  }
                }
              },
              "required": [
                "results"
              ]
            }
          }
        }
      },
      "result": {
        "compatible": false,
        "operations": {
          "task.create": {
            "match": "primary_key",
            "kind": "match",
            "input": "compatible"
          },
          "task.list": {
            "match": "primary_key",
            "kind": "match",
            "output": "incompatible"
          }
        }
      }
    }
  ]
}
